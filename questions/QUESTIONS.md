# Exercise Questions
This is the second part of the take home exercise, intended to be completed after the coding challenge. If you have not yet completed the coding challenge, start by following the instructions in the [Code challenge README](https://github.com/framework-homeownership/candidate-challenges/blob/main/challenge/README.md) in the `challenge/` directory of this repository and return to this section after.

This part of the exercise will provide a theoretical scenario, building off of the work you have done for the coding exercise, and ask some questions around that scenario.

## Scenario
This scenario will expand on the work you did for the Library module, but will NOT require any new code to be written. The output from this section will be written answers to questions and some documentation. You are welcome to email any of your contacts at Framework to ask any questions you have about the exercise. These questions are intended to be open-ended, please provide as much or as little detail as is you think relevant.

Now that the code changes to the Library module are complete, you have been tasked with designing a new User service to track which Library resources an individual has checked out, as well as restricting access to users without an account. At a minimum this service will need to be comprised of a new API and new table(s) in a pre-existing RDBMS. The intent is to launch this new service on a cloud provider (of your choice), with the following requirements:
- Communicates with a backend database.
- Caching mechanism for data retrieved from RDBMS.
- Should have redundancy and high availability.
- Calls to API must be authenticated and authorized.
- Average request load to API expected to be ~50 calls per minute, but with spikes to ~10,000,000 requests per minute a few times per month. These spikes should be handled without manual intervention.
- After the initial deployments, subsequent ones should be fairly automated.


Question 1. How would you design the data model for this new service, and how would it relate to the Library? Please provide some sort of schema or diagram and document any concerns/considerations you made that are not directly reflected in your documentation. Documentation can be hand drawn or generated with a tool of your choice.

A library has users, just as it has contents.  When a user borrows content, the userId, contentId, and due date are recorded in UserContents

Table: Users                                        Table: UserContents                        
id: UUID (PK)                                       id: UUID   (alternatively, userId and contentId could be used a combination PK)
(. . .other identifying fields, name, email, etc)   userId: UUID, FK User.id
active: bool                                        contentId: UUID, FK Content.contentId
balance: Currency                                   dueDate: DATE
cardExpirationDate: DATE

Question 2. How would you control access to Library content? Describe what this mechanism would look like and list any services you would use to accomplish this goal.

I personally would use Auth0 because I have some experience with that service and want to avoid hand-rolled systems because I have always found them to be inadequate/overly complicated/just painful.  

Users can GET contents, but only librarians (ie admins) can PUT/PATCH/POST/DELETE content or alter user data.  Perhaps, users under a certain age are only authorized for certain Content.ContentTypes, but as an actual former librarian, I cannot advocate for such a policy personally. Really, most auth solutions on the market should do the trick.

Question 3. How would you ensure your service would continue functioning if the datacenter it was deployed in had a catastrophic failure and was completely wiped off the map.

The application should be deployed in multiple regions, for graceful failover in such a circumstance.  Database back-ups should, similarly, be taken regularly and disseminated.

Question 4. Describe how you would approach building a dynamically scalable API. Are there any prerequisites for the service code for this to work?

I have some experience with Azure, Kubernetes and Terraform, but not much.  I'm aware that Azure collects metrics (CPU usage, memory etc) and can auto-scale in response to hitting certain thresholds. (I would expect AWS to functional similarly) Similarly I know if usage of a particular resource is high, we can have Kubernetes create additional resources.  

Question 5. Provide a diagram of how you envision the architecture for this to be deployed in a cloud provider. Any provider you choose is acceptable, just be sure to document the services/tools you would be using. Diagrams can be hand drawn or generated by a tool of your choice.

                ~~~~~~~ (this is how I am representing the cloud)
                (Azure)
                ~~~~~~~                                 
                ^                                       ^               ^
                |                                       |               |
                |                                    Auth Service       |
                |                                       ^               |
                |                                       |               |
                |                                       |               |
                ^ (this supposed to be bidirectional)   ^               ^
                Postgres/SQL Server                     API             MongoDB(collection materials-- optional)
                ()                                                      ()
                ()                                                      ()
                ()                                                      ()

I've included a Mongo database for digital collections of contents.  The metadata should still live in the relational database for ease of use. 

Question 6. After a successful launch of your brand new service (congrats!) it runs flawlessly for a few months. Then suddenly, every Tuesday and Thursday the service falls over and requires manual intervention to get it running again. You don't see any obvious problems. How would you go about troubleshooting this issue? Detail your approach and any tools/services you would use to accomplish this task.

I would use DataDog (or any other, similar observability tool), to gain insight into user behavior.  Maybe traffic is especially heavy on those days and resources should be autoscaled up.  Additionally, I would institute health checks.  If a health check fails, the service should restart itself.  

Question 7. Are there any requirements that have not been given as part of this scenario that you would consider essential and push to have included for any service being developed?

Given my experience as a librarian, I would add a ton of tables-- RareContent, RareContentEnvironmentRequirements, and other, even more esoteric tables that don't matter for the purposes of this exercise.  I would also add an email/texting queue service to notify users about due dates, library programs, etc. If we're running a whole library consortium, we'd also need to track human resources and potentially other library locations, each with their own collections. Finally, I included a column for overdue balances in the Users table earlier, so potentially we'd need a payment processing service as well.